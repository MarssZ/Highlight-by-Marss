---
description: 基于设计文档生成实施任务清单
argument-hint: [功能名称]
---

# 目标

基于已批准的设计文档，创建测试驱动的渐进式编码任务清单。

## 核心理念

### 价值观
- **渐进交付**：小步快跑，每步可验证
- **MVP优先**：聚焦核心价值
- **简约至上**：避免过度工程化
- **快速验证**：尽早获得可工作的版本

### 方法论
1. **上下文完整**：每个任务包含充分的背景信息
2. **人工可验证**：每个任务都有可验证的结果（用户可见效果或Console输出）
3. **渐进式价值**：每一步都产生立即可见或可测试的效果

## 任务设计原则

### 必须包含
- 编写新代码文件
- 创建单元/集成测试
- 修改现有代码
- 重构优化代码

### 严禁包含
- 用户验收测试
- 生产环境部署
- 性能监控分析
- 用户培训文档
- 非编码类活动

## 任务格式

```markdown
- [ ] 1. 任务目标（动词+名词）
  - 需求：REQ-X.Y（具体子需求编号）
  - 文件：需要创建/修改的文件路径
  - 验证：做X操作，看到Y结果（用户可见效果 或 Console特定输出 或 技术可测试结果）
  
  - [ ] 1.1 子任务（可选）
    - 具体实现细节
```

## 输出规范

1. **文件路径**：`specs/{功能名称}/tasks.md`

2. **结构要求**：
   - 最多两级层次
   - 使用复选框列表
   - 任务按实现顺序排列
   - 每个任务独立可执行

3. **内容要求**：
   - 覆盖所有功能需求
   - 引用具体需求编号
   - 指明目标文件/组件
   - 包含验证方法

## 任务排序铁律

**按渐进式用户价值排序，而非技术架构层次**

1. **最小可见功能**：用户立即可见的UI效果
2. **核心交互**：用户可操作的功能（点击、右键）
3. **数据持久化**：刷新后功能保持
4. **完善优化**：错误处理、边缘情况

**禁止技术导向排序**：❌ 数据层→业务层→表现层

## 验证方式指南

### 三种验证方式优先级：

1. **用户可见效果**（最优）
   ```
   验证：选中文本 → 立即显示黄色高亮效果
   验证：点击高亮文本 → 弹出评论输入对话框
   ```

2. **Console输出验证**（次优，用于架构/数据任务）
   ```
   验证：F12控制台显示 "Platform adapter loaded: GeminiAdapter"
   验证：控制台输出 "Highlight data: {id: 1, text: '选中内容', comment: ''}"
   ```

3. **技术可测试**（保底，用于底层功能）
   ```
   验证：调用API返回正确的DOM元素数组
   验证：单元测试通过，覆盖率达到90%
   ```

### Console输出规范

对于不易直接观察的架构性任务，使用具体的Console输出：

**✅ 好的Console验证：**
- "Platform detected: gemini.google.com"
- "Found 3 copy buttons in message containers"
- "Highlight saved: {id: 1, text: '机器学习', comment: '重要概念'}"

**❌ 模糊的验证：**
- "系统正常工作"
- "功能加载成功"
- "代码运行无误"

## 质量检查

生成任务后，确保：
- [ ] 所有需求都有对应任务
- [ ] 任务间没有断层或孤岛
- [ ] 每个任务都有明确验证方式（优先用户可见 → Console输出 → 技术测试）
- [ ] 按用户价值递增，而非技术复杂度
- [ ] 架构性任务提供具体Console输出验证

## 工作流程

1. 检查设计文档是否存在且已批准
2. 分析设计，提取可编码的实现点
3. 生成任务清单
4. 询问用户："任务清单是否符合预期？"（使用 'spec-tasks-review' 作为原因）
5. 根据反馈迭代，直到获得明确批准
6. 提醒用户可通过tasks.md开始执行

## 特别说明

- 本流程仅生成计划文档，不执行实际编码
- 发现需求或设计问题时，应退回相应阶段
- 为编码助手优化任务描述，提供充分上下文
- 确保每个任务都是具体的编码行为

## 任务
现在，请基于已批准的设计文档 `.specs/{feature_name}/design.md` ，创建测试驱动的渐进式编码任务清单：