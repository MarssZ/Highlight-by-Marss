# Highlight by Marss

一个专为AI聊天平台设计的Chrome扩展，让你能轻松高亮重要内容、添加评论，并复制带完整标记的回复。

## ✨ 核心功能

### 🎯 智能高亮
- **选中即高亮**：在Gemini AI回复中选择文本，立即应用黄色高亮效果
- **跨元素支持**：使用CSS.highlights API，支持复杂的跨标签文本选择
- **精确控制**：Ctrl+点击移除高亮（Mac用Cmd+点击），Ctrl+Z撤销最后一个高亮（Mac用Cmd+Z）
- **范围限制**：只在AI回复区域生效，不会误触其他页面内容

### 💬 评论系统
- **点击添加评论**：点击高亮文本弹出专业评论输入框
- **🔖 可见指示器**：有评论的高亮显示书签图标，一目了然
- **悬停查看**：鼠标悬停🔖图标即可快速查看评论内容
- **双重编辑入口**：点击高亮文本或🔖图标都能编辑评论
- **智能UI**：Material Design风格浮动对话框，支持键盘快捷键

### 📋 智能复制
- **劫持现有按钮**：无缝增强Gemini原生复制功能，无需额外UI
- **格式化输出**：自动生成XML格式的带标记内容
- **评论集成**：复制时自动包含高亮和评论信息
- **安全处理**：XML属性自动转义，支持特殊字符

## 🚀 使用指南

### 基础高亮操作
1. 在Gemini AI回复中选择你想标记的文本
2. 文本立即变成黄色高亮
3. Ctrl+点击高亮文本可移除（Mac用Cmd+点击）
4. Ctrl+Z可撤销最后一个高亮（Mac用Cmd+Z）

### 评论功能
1. **添加评论**：点击高亮文本弹出评论输入框
2. **编辑评论**：再次点击高亮文本或🔖图标编辑
3. **查看评论**：鼠标悬停🔖图标快速查看
4. **快捷操作**：
   - Ctrl+Enter：保存评论（Mac用Cmd+Enter）
   - Escape：取消编辑
   - 点击外部：关闭对话框

### 复制增强
1. 正常高亮AI回复内容
2. （可选）为重要高亮添加评论
3. 点击Gemini原生的复制按钮
4. 粘贴时自动获得格式化内容：

```xml
<!-- 无评论的高亮 -->
<highlight>重要文本</highlight>

<!-- 有评论的高亮 -->
<highlight comment="这是我的评论">重要文本</highlight>
```

## 💡 设计亮点

### 用户体验优化
- **防误触机制**：高亮后300ms内不触发评论，避免冲突
- **智能定位**：评论对话框自动避开屏幕边界
- **内联指示器**：🔖图标跟随文本滚动，不会"飘走"
- **视觉一致**：使用🔖书签图标，白色背景下清晰可见

### 技术特色
- **零DOM污染**：使用CSS.highlights API，不修改页面结构
- **精确识别**：智能检测AI回复区域，避免误操作
- **优雅降级**：支持不同浏览器环境的回退方案
- **性能优化**：事件去抖、智能更新，避免不必要的DOM操作
- **🆕 模块化架构**：平台适配器模式，统一接口抽象
- **🆕 扩展性**：为多平台支持奠定坚实基础

## 🛠️ 安装方法

### 开发者安装
1. 克隆此仓库到本地
2. 打开Chrome扩展管理页面 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录
6. 访问支持的平台开始使用：
   - [Gemini](https://gemini.google.com)
   - [Claude](https://claude.ai)

### 验证安装
- 控制台显示 "Highlight by Marss loaded"
- 在AI回复中选择文本能正常高亮
- 点击高亮文本能弹出评论输入框

## 📁 项目结构

```
highlight-by-marss/
├── manifest.json           # Chrome扩展配置
├── src/
│   ├── content.js          # 主要逻辑（高亮功能+适配器集成）
│   ├── copy-enhancer.js    # 复制功能增强（按钮识别+智能复制）
│   ├── comment-manager.js  # 评论功能管理（UI+指示器+交互）
│   ├── platform/           # 🆕 平台适配器架构
│   │   ├── platform-adapter.js  # 适配器基础接口
│   │   ├── gemini-adapter.js     # Gemini平台适配器
│   │   └── claude-adapter.js     # Claude平台适配器
│   └── background.js       # 后台脚本
├── styles/
│   ├── content.css         # 高亮样式
│   └── comment.css         # 评论UI样式（Material Design）
└── specs/                  # 功能规格文档
    └── highlight-by-marss/
        ├── requirements.md # 需求文档
        ├── design.md      # 设计文档
        └── tasks.md       # 任务清单
```

## 🎯 支持平台

基于模块化适配器架构，目前支持：

### ✅ 已支持
- **Gemini** (gemini.google.com)
- **Claude** (claude.ai)

### 🚧 规划中
- **ChatGPT** (chat.openai.com)

每个平台都包括：
- AI回复区域智能识别
- 现有复制按钮无缝集成
- 动态内容加载适配

## 🔮 未来规划

### 可选增强功能
- **ChatGPT支持**：完成三大主流平台覆盖
- **数据持久化**：页面刷新保持高亮和评论
- **导出功能**：批量导出高亮和评论内容
- **稳定性增强**：错误处理和动态内容监听
- **主题支持**：深色模式优化

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境
- 基于Manifest V3
- 使用原生JavaScript，无框架依赖
- 遵循Material Design设计规范

### 主要开发原则
- 用户体验优先
- 零侵入式设计
- 性能和稳定性并重
- 代码简洁易维护

---

**让AI对话更高效，让重要内容不遗漏！** ✨